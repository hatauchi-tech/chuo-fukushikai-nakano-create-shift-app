# シフト管理自動化システム 運用手順書

**作成日**: 2025年11月27日
**対象者**: システム管理者、シフト作成担当者、従業員
**更新**: v1.0

---

## 📋 目次

1. [月次シフト作成フロー](#月次シフト作成フロー)
2. [日常業務](#日常業務)
3. [従業員向け操作ガイド](#従業員向け操作ガイド)
4. [管理者向け操作ガイド](#管理者向け操作ガイド)
5. [データ管理](#データ管理)
6. [トラブルシューティング](#トラブルシューティング)
7. [よくある質問（FAQ）](#よくある質問faq)

---

## 月次シフト作成フロー

毎月のシフト作成は以下の7ステップで行います。

### 📅 スケジュール例（翌月分のシフト作成）

| 日付 | 作業内容 | 担当者 | 所要時間 |
|-----|---------|--------|---------|
| 毎月10日 | ステップ1: 提出期間設定 | 管理者 | 5分 |
| 10日～20日 | ステップ2: 従業員が休み希望提出 | 全従業員 | 各5分 |
| 20日 | ステップ3: 提出締め切り | 管理者 | 5分 |
| 21日 | ステップ4: シフト案自動生成 | 管理者 | 5分 |
| 21日～25日 | ステップ5: 手動調整 | 管理者 | 1～2時間 |
| 25日 | ステップ6: ルールチェック | 管理者 | 10分 |
| 25日 | ステップ7: シフト登録・公開 | 管理者 | 10分 |

---

### ステップ1: 提出期間設定（管理者）

翌月の休み希望提出を受け付ける設定を行います。

#### 手順

1. **スプレッドシートを開く**
   - シフト管理システムのスプレッドシートにアクセス

2. **M_設定シートを開く**
   - 下部のシートタブから「M_設定」をクリック

3. **新しい行を追加**
   - 最終行の下に以下を入力：

| 設定ID | 設定値 |
|--------|--------|
| SUBMISSION_LOCK_202501 | FALSE |

**設定IDの形式**: `SUBMISSION_LOCK_YYYYMM`
- `YYYY`: 西暦4桁
- `MM`: 月2桁（01～12）

**設定値**:
- `FALSE`: 提出受付中
- `TRUE`: 締め切り（編集不可）

4. **保存**
   - 自動保存されます

#### 設定例

```
2025年1月分の提出を受け付ける場合:
設定ID: SUBMISSION_LOCK_202501
設定値: FALSE
```

---

### ステップ2: 従業員が休み希望提出（全従業員）

従業員がWebアプリから休み希望を提出します。

#### 従業員向け手順

1. **Webアプリにアクセス**
   - 配布されたURLをブラウザで開く
   - ブックマーク推奨

2. **ログイン**
   - ログインID: 個人に配布されたID
   - パスワード: 個人に配布されたパスワード

3. **対象月を選択**
   - 「対象月」ドロップダウンから該当月を選択
   - 例: `2025-01`（2025年1月）

4. **カレンダーから日付を選択**
   - 休みたい日をクリック（青色に変わる）
   - 複数選択可能
   - もう一度クリックで解除

5. **特記事項を入力（任意）**
   - 特別な事情がある場合は入力
   - 例: 「通院のため」「家族行事」

6. **保存**
   - 「保存」ボタンをクリック
   - 「保存しました」というメッセージが表示される

7. **確認**
   - 再度ログインすると、保存した内容が表示される
   - 締め切り前なら何度でも変更可能

#### 注意事項

- **月3～4日程度**の希望日数を推奨
- 締め切り後は閲覧のみ可能（編集不可）
- 希望日が必ず休みになるわけではありません（あくまで希望）

---

### ステップ3: 提出締め切り（管理者）

休み希望の提出を締め切ります。

#### 手順

1. **スプレッドシートを開く**
2. **M_設定シートを開く**
3. **該当月の設定値を変更**
   - `SUBMISSION_LOCK_202501` の設定値を `FALSE` → `TRUE` に変更

4. **確認**
   - 従業員がWebアプリで編集できなくなっていることを確認

#### 変更例

```
変更前:
設定ID: SUBMISSION_LOCK_202501
設定値: FALSE

変更後:
設定ID: SUBMISSION_LOCK_202501
設定値: TRUE  ← 変更
```

---

### ステップ4: シフト案自動生成（管理者）

システムが休み希望を反映したシフト案を自動生成します。

#### 手順

1. **スプレッドシートを開く**

2. **カスタムメニューから実行**
   - メニューバーの「📅 シフト管理」をクリック
   - 「✨ シフト案作成」を選択

3. **対象年月を入力**
   - ダイアログに年月を入力
   - 例: `2025/01`
   - 「OK」をクリック

4. **生成完了を確認**
   - 「シフト案を作成しました」というメッセージが表示される
   - 新しいシート「シフト作業用」が作成される

5. **シフト作業用シートを確認**
   - ガントチャート形式でシフト案が表示される
   - 横軸: 日付
   - 縦軸: 職員名
   - セル: シフト名（早出、日勤、遅出、夜勤、休み）

#### 生成されるシフト案の特徴

- ✅ 休み希望が反映されている
- ⚠️ ランダム配置による「たたき台」レベル
- ⚠️ ルール違反がある可能性あり
- 🔧 必ず手動調整が必要

---

### ステップ5: 手動調整（管理者）

シフト作業用シートで手動調整を行います。

#### 調整方法

1. **シフト作業用シートを開く**

2. **セルをクリックして編集**
   - セルをダブルクリック
   - シフト名を入力（ドロップダウンなし）
   - 入力値: `早出`, `日勤`, `遅出`, `夜勤`, `休み`

3. **よくある調整**
   - 最低人数不足の日に人員を追加
   - 連勤が多い人の休みを増やす
   - 資格者のいない夜勤に資格者を配置
   - インターバル違反（遅出→翌日早出）を修正

4. **色分けの活用**
   - 手動で色を付けて管理しやすくする
   - 例: 夜勤を黄色、休みをグレーなど

5. **こまめに保存**
   - スプレッドシートは自動保存されますが、念のため Ctrl+S

#### 調整のポイント

**優先順位**:
1. 最低人数の確保（最優先）
2. 資格者の配置
3. 連勤制限の遵守
4. インターバルの確保
5. 勤務日数の均等化

**よくあるパターン**:
- 夜勤明けは必ず2日休み
- 遅出の翌日は日勤以降（早出NG）
- 日曜日は日勤を減らしてOK
- 喀痰吸引資格者を毎日夜勤に配置

---

### ステップ6: ルールチェック（管理者）

調整後のシフトが11個のルールに違反していないかチェックします。

#### 手順

1. **カスタムメニューから実行**
   - メニューバーの「📅 シフト管理」をクリック
   - 「✅ ルールチェック」を選択

2. **対象年月を入力**
   - 例: `2025/01`
   - 「OK」をクリック

3. **結果を確認**

   **違反がない場合**:
   ```
   ✅ ルール違反はありませんでした！
   ```

   **違反がある場合**:
   ```
   ⚠️ 15件の違反が見つかりました:
   • グループ1 5日: 早出が1名（最低2名必要）
   • 田中花子: 1日〜6日 (6連勤)
   • 佐藤次郎: 10日遅出 → 11日早出
   ...
   ```

4. **違反箇所を確認**
   - シフト作業用シートで違反箇所が**赤くハイライト**される

5. **修正**
   - ハイライトされたセルを修正
   - 再度ルールチェックを実行

6. **違反がなくなるまで繰り返す**
   - 完全に違反をなくすか、許容範囲まで減らす

#### 11個のルール詳細

| No | ルール | 説明 |
|----|-------|------|
| 1 | 早出最低人数 | 各グループ、各日で早出2名以上 |
| 2 | 日勤最低人数 | 各グループ、各日で日勤1名以上（日曜は0名OK） |
| 3 | 遅出最低人数 | 各グループ、各日で遅出1名以上 |
| 4 | 夜勤最低人数 | 各グループ、各日で夜勤1名以上 |
| 5 | 休み希望 | 月3～4日程度（警告のみ） |
| 6 | 連勤制限 | 連続5日まで（6連勤以上でエラー） |
| 7 | インターバル | 遅出→翌日早出は禁止 |
| 8 | 勤務日数上限 | 月21日以内（夜勤は2日分換算） |
| 9 | 夜勤明け | 夜勤→休→休（翌日・翌々日は休み） |
| 10 | 勤務配慮 | 勤務配慮フラグありは夜勤免除 |
| 11 | 資格者配置 | 全グループの夜勤に喀痰吸引資格者が最低1名 |

#### 違反が解消できない場合

- 人員不足の場合は要員補充を検討
- やむを得ない場合は管理者判断で例外を認める
- 警告を承知の上で登録可能（確認ダイアログが表示される）

---

### ステップ7: シフト登録・公開（管理者）

最終確認後、シフトを確定してGoogleカレンダーに登録します。

#### 手順

1. **最終確認**
   - シフト作業用シートを目視で確認
   - ルールチェックを再実行

2. **カスタムメニューから実行**
   - メニューバーの「📅 シフト管理」をクリック
   - 「📝 シフト登録」を選択

3. **対象年月を入力**
   - 例: `2025/01`
   - 「OK」をクリック

4. **警告の確認（違反がある場合）**
   ```
   ⚠️ 3件のルール違反があります。
   登録を続けますか？
   ```
   - 問題なければ「はい」をクリック

5. **登録完了を確認**
   ```
   ✅ 186件のシフトをカレンダーに登録しました
   ```

6. **Googleカレンダーで確認**
   - 各グループのGoogleカレンダーを開く
   - シフトが登録されていることを確認
   - イベント形式: `【早出】山田太郎`

7. **スプレッドシートで確認**
   - `T_確定シフト` シートにデータが保存される
   - カレンダーイベントIDも記録される

#### 登録後の処理

- **従業員への通知**
  - Googleカレンダーの共有設定で通知
  - または別途メール・掲示板で周知

- **印刷用資料の作成**
  - シフト作業用シートを印刷
  - 掲示板に掲示

---

## 日常業務

### 職員情報の更新

#### 新規職員の追加

1. **Webアプリにログイン（管理者）**
2. 「職員マスタ管理」を開く
3. 「+ 新規追加」をクリック
4. 情報を入力して「保存」

#### 職員情報の編集

1. 「職員マスタ管理」を開く
2. 該当職員の「編集」をクリック
3. 情報を修正して「保存」

#### 職員の退職処理

1. 該当職員を編集
2. 「有効」のチェックを外す
3. 保存（ログイン不可になる）

**注意**: データは削除せず「無効化」を推奨

---

### シフトの急な変更

#### 個別のシフト変更（1日だけ変更）

**方法1: Googleカレンダーで直接変更**
1. Googleカレンダーを開く
2. 該当イベントをクリック
3. 編集または削除
4. **注意**: スプレッドシートには反映されない

**方法2: スプレッドシートで変更して再登録**
1. シフト作業用シートを編集
2. ルールチェック
3. シフト登録を実行
4. **既存のイベントが上書きされる**

#### 緊急時の対応

- 急病などで当日シフト変更が必要な場合
- Googleカレンダーで直接編集が最速
- 後日スプレッドシートも更新推奨

---

### データの確認

#### 休み希望の確認

1. スプレッドシートの `T_シフト休み希望` シートを開く
2. 職員名と日付で検索
3. 提出日時も確認可能

#### 確定シフトの確認

1. スプレッドシートの `T_確定シフト` シートを開く
2. 月別、職員別にフィルタ
3. カレンダーイベントIDも記録されている

---

## 従業員向け操作ガイド

### 初回ログイン

1. **URLにアクセス**
   - 管理者から配布されたURL

2. **ログイン**
   - ログインID: 管理者から配布
   - パスワード: 管理者から配布

3. **パスワード変更（推奨）**
   - 管理者に依頼して変更してもらう
   - または管理者が職員マスタで変更

### 休み希望の提出

#### 基本操作

1. ログイン
2. 対象月を選択
3. カレンダーから希望日をクリック
4. 特記事項を入力（任意）
5. 「保存」をクリック

#### 変更・修正

- 締め切り前なら何度でも変更可能
- 既存の内容が表示されるので、追加・削除可能

#### 確認

- 保存後、再度ログインすると内容が表示される
- 締め切り後は閲覧のみ（編集不可）

### よくある質問

**Q: 何日まで希望を出せますか？**
A: 特に制限はありませんが、月3～4日程度を推奨します。

**Q: 希望した日は必ず休めますか？**
A: あくまで希望なので、業務の都合上、希望通りにならない場合もあります。

**Q: 締め切り後に変更したい場合は？**
A: 管理者に直接連絡してください。

**Q: パスワードを忘れました**
A: 管理者に連絡してリセットしてもらってください。

---

## 管理者向け操作ガイド

### Webアプリのデプロイ更新

コードを修正した場合は再デプロイが必要です。

1. GASエディタを開く
2. 「デプロイ」→「デプロイを管理」
3. 既存のデプロイの鉛筆アイコンをクリック
4. 「バージョン」→「新バージョン」
5. 「デプロイ」をクリック
6. URLは変わらない

### スクリプトのメンテナンス

#### 定期的な確認事項

- **月1回**: データベースシートの整合性チェック
- **月1回**: 不要な古いシフト作業用シートの削除
- **年1回**: パスワードの更新推奨

#### ログの確認

1. GASエディタを開く
2. 「表示」→「ログ」
3. エラーや警告を確認

---

## データ管理

### バックアップ

#### スプレッドシートのバックアップ

**推奨頻度**: 月1回（シフト確定後）

1. スプレッドシートを開く
2. 「ファイル」→「コピーを作成」
3. 名前を `シフト管理システム_バックアップ_20250101` 形式で保存
4. Google Driveの専用フォルダに保管

#### GASコードのバックアップ

**推奨頻度**: コード変更時

1. GASエディタを開く
2. 各 `.gs` ファイルの内容をコピー
3. ローカルPCまたはGitHubに保存

### データの削除

#### 古いシフトデータの削除

1. `T_確定シフト` シートを開く
2. 削除したい月のデータを選択
3. 行を右クリック→「行を削除」

**注意**: カレンダーのイベントは手動で削除

#### 古い休み希望の削除

1. `T_シフト休み希望` シートを開く
2. 古いデータを選択
3. 行を削除

### データのエクスポート

#### CSV形式でエクスポート

1. 対象シートを開く
2. 「ファイル」→「ダウンロード」→「カンマ区切り形式（.csv）」
3. Excelなどで開ける

---

## トラブルシューティング

### よくあるエラーと対処法

#### エラー1: 「スプレッドシートが見つかりません」

**原因**: スプレッドシートIDが正しくない

**対処**:
1. GASエディタ→「プロジェクトの設定」
2. スクリプトプロパティで `SPREADSHEET_ID` を確認
3. 正しいIDに修正

#### エラー2: 「権限がありません」

**原因**: GASの実行権限が不足

**対処**:
1. GASエディタで任意の関数を実行
2. 「承認が必要です」→「許可」をクリック

#### エラー3: ログインできない

**原因**: ログインID/パスワード誤り、または無効化

**対処**:
1. `M_職員` シートでログインIDを確認
2. 「有効」フラグが `TRUE` か確認
3. パスワードを再設定

#### エラー4: カレンダーに登録されない

**原因**: カレンダーIDが誤り、または権限不足

**対処**:
1. `M_職員` シートでカレンダーIDを確認
2. GoogleカレンダーでIDを再取得
3. GASにカレンダー権限があるか確認

#### エラー5: シフト案が作成されない

**原因**: 職員データまたはシフトマスタが未設定

**対処**:
1. `M_職員` シートに有効な職員がいるか確認
2. `M_シフト` シートにシフトマスタがあるか確認
3. GASの実行ログでエラー内容を確認

---

## よくある質問（FAQ）

### Q1: シフト案の自動生成の精度は？

A: **完全最適化ではありません**。ランダム配置による「たたき台」レベルなので、必ず手動調整が必要です。休み希望は反映されますが、最低人数やルールは考慮されない場合があります。

### Q2: 過去のシフトを修正できますか？

A: カレンダーは修正可能ですが、`T_確定シフト` シートは確定データなので修正は推奨しません。履歴として残すことをお勧めします。

### Q3: 職員が50人以上いても動作しますか？

A: 基本的に動作しますが、処理時間が長くなる可能性があります。グループ分けを活用して負荷を分散することを推奨します。

### Q4: 複数の管理者で運用できますか？

A: 可能です。`M_職員` シートで複数人の役職を「管理者」に設定すれば、全員が管理者機能を使用できます。

### Q5: スマートフォンから操作できますか？

A: Webアプリはレスポンシブデザインなので、スマートフォンからも操作可能です。ただし、シフト作業用シートの編集はPC推奨です。

### Q6: データは何年分保存できますか？

A: スプレッドシートの制限内（500万セル）であれば無制限です。定期的に古いデータをバックアップして削除することを推奨します。

### Q7: カレンダーへの登録時間は変更できますか？

A: `M_シフト` シートの「開始時間」「終了時間」を変更すれば、次回登録時から反映されます。

### Q8: 夜勤の時間設定は？

A: デフォルトでは 17:00～翌朝09:00 です。`M_シフト` シートで変更可能です。システムは自動的に翌日まで跨ぐ設定になります。

---

## メンテナンススケジュール

### 日次
- なし（自動運用）

### 週次
- なし

### 月次
- シフト作成フローの実施
- データバックアップ
- ログの確認

### 年次
- 全職員のパスワード変更推奨
- システム全体の動作確認
- データの整理・古いデータの削除

---

## 改善・カスタマイズ

システムの改善やカスタマイズが必要な場合：

1. **要望の整理**
   - 何を改善したいか明確にする
   - 現状の問題点を洗い出す

2. **技術者への相談**
   - GASコードの修正が必要な場合
   - README.md の「技術スタック」を参照

3. **テスト環境での検証**
   - 本番環境を複製してテスト
   - 動作確認後に本番反映

---

## サポート

運用に関する質問や問題が発生した場合：

1. **本手順書を確認**
2. **導入手順書.md を確認**
3. **README.md を確認**
4. **GASの実行ログを確認**
5. **システム管理者に連絡**

---

**運用をスムーズに進めるために、本手順書を定期的に見直してください。**

**更新履歴**:
- v1.0 (2025/11/27): 初版作成
