# シフト管理自動化システム 取扱説明書

**対象**: 全職員・管理者
**システムバージョン**: v3.0

---

## はじめに

このシステムは、毎月のシフト作成を自動化するためのWebアプリです。
職員の皆さんは「休み希望の入力」、管理者は「シフトの確認・修正・確定」を行います。

---

## 職員向け操作ガイド

### ログイン

1. 管理者から配布されたURLをブラウザで開きます
2. **ログインID** と **パスワード** を入力して「ログイン」ボタンを押します

### 休み希望を入力する

1. ログイン後、「休み希望提出」画面が表示されます
2. **対象月** を選択します（年月プルダウン）
3. カレンダー上の **希望日をクリック** します
   - 1回目のクリック → 「第1希望」（最も優先される）
   - 2回目のクリック → 「第2希望」
   - 3回目以降も同様に続きます
   - もう一度クリックすると解除されます
4. 公休日数分まで選択できます（例: 9日分）
5. **「保存」ボタン** を押して完了です

**ポイント:**
- 第1希望は **必ず** 反映されます
- 第2希望以降は **できるだけ** 反映されますが、他の職員と重なった場合は調整されることがあります
- 締切後は変更できません。早めに提出しましょう

### マニュアルを見る

- 画面右上の **「マニュアル」ボタン** からいつでも確認できます
- 全体の流れ、操作方法、ルール一覧、よくある質問が掲載されています

---

## 管理者向け操作ガイド

管理者でログインすると、画面上部にナビゲーションメニューが表示されます。

### 毎月の作業手順

#### ステップ1: 提出締切を設定する

1. **「シフト管理」** 画面を開きます
2. 対象月を選択し、**「ロック（締切）」** ボタンを押します
3. 職員は締切後に休み希望を変更できなくなります

#### ステップ2: 勤務指定を入力する（任意）

研修や会議など、あらかじめ決まっている勤務がある場合:

1. **「勤務指定」** 画面を開きます
2. 対象月を選択して「表示」
3. 「新規勤務指定を追加」で職員名・日付・シフト種別を選択して「追加」
4. 指定した内容はPython計算時に固定制約として反映されます

#### ステップ3: CSV出力 → 自動計算を実行

1. **「シフト管理」** 画面で **「3種CSV一括出力」** を押します
2. Google DriveのinputフォルダにCSVが保存されます
3. **Google Colab** のノートブックを開きます
4. 対象年月を設定してセルを実行します
5. 計算が完了すると、自動でシステムにシフト結果が取り込まれます

**計算が失敗した場合:**
- 診断レポートが出力されます
- 「シフト管理」画面の診断レポートセクションで原因を確認できます
- よくある原因: グループの人数不足、夜勤可能者不足、休み希望の集中

#### ステップ4: シフトを確認・修正する

1. **「シフト修正」** 画面を開きます
2. 対象月を選択して **「表示」** を押します

**フィルター機能:**
- 画面上部のチェックボックスで表示を絞り込めます
  - **グループ**: G1〜G6から複数選択
  - **ユニット**: ユニットで絞込
  - **雇用形態**: 常勤/パートで絞込
  - **喀痰吸引**: 資格者のみ表示
  - **勤務配慮**: 配慮ありのみ表示
- チェックを変更すると **即座に** 表示が切り替わります（読み込みなし）
- フィルター中に編集した内容は保持されます

**シフトの修正:**
- 各セルのプルダウンからシフトを変更できます
- 変更すると統計テーブルに即座に反映されます
- **黄色背景の行** は喀痰吸引資格者です。夜勤に資格者が入っているか確認してください

**統計の確認:**
- **日別人数集計**: 各日のシフト別人数
- **個人別統計**: 勤務日数と夜勤回数

#### ステップ5: シフトを確定する

確認が完了したら:

- **「確定」ボタン**: シフトデータのみ保存します
- **「Googleカレンダー登録して確定」ボタン**: シフト保存に加えて、各職員のGoogleカレンダーにも登録します

### 診断レポートの確認

1. **「シフト管理」** 画面を開きます
2. 「診断レポート」セクションが表示されます
3. 氏名やグループでフィルターして検索できます
4. レポートには以下が含まれます:
   - エラー（法的要件違反など重大な問題）
   - 警告（最低人数不足など改善推奨の問題）
   - 統計（グループ別の充足状況）

### 職員マスタの管理

**「職員マスタ管理」** 画面で以下を管理します:

| 項目 | 説明 |
|------|------|
| 氏名 | 職員名 |
| グループ(1〜6) | シフトグループ |
| 雇用形態 | 常勤/パート |
| 喀痰吸引資格者 | ONにすると法定配置チェックの対象 |
| 勤務配慮 | ONにすると夜勤が免除される |
| 有効 | OFFにするとログイン不可・シフト対象外 |

### シフトマスタの管理

**「シフトマスタ管理」** 画面で各シフトの名前と時間を管理します。
ここで設定したシフト名がシステム全体に反映されます。

---

## シフトルール一覧

### 必ず守るルール

| ルール | 内容 |
|--------|------|
| 公休数 | 月の暦日数 - 公休数 = 勤務日数（必ず一致） |
| 連勤制限 | 5日連続まで（6連勤以上は不可） |
| 夜勤明け | 夜勤の翌日と翌々日は必ず休み |
| インターバル | 遅出の翌日に早出は入れない |
| 勤務配慮 | 配慮ありの職員は夜勤なし |
| 資格者配置 | 毎日、施設全体で1名以上の喀痰吸引資格者が勤務 |
| 第1休み希望 | 必ず休みになる |

### できるだけ守るルール

| ルール | 内容 |
|--------|------|
| 最低人数 | 早出2名/日勤1名（日曜0可）/遅出1名/夜勤1名 |
| 第2希望以降 | できるだけ休みにするが、調整される場合あり |
| 夜勤の資格者 | 夜勤にも1名以上の資格者を配置 |

### 夜勤の休日カウントについて

夜勤は日をまたぐため、特殊なカウントになります:

```
21日: 夜勤（夕方〜翌朝まで勤務）
22日: 休み（夜勤明け = 早朝まで働いている → 公休ではない）
23日: 休み（ここが実質の公休1日）
```

---

## よくある質問

### 全職員共通

**Q. パスワードを忘れました**
A. 管理者に連絡して、リセットしてもらってください。

**Q. 休み希望を出し忘れました**
A. 締切前ならいつでも入力できます。締切後は管理者に相談してください。

**Q. 第1希望は必ず通りますか？**
A. はい、第1希望は必ず休みになります。

**Q. 第2希望以降は通りますか？**
A. できるだけ反映しますが、他の職員の希望や人数制約と衝突する場合は調整されます。

### 管理者向け

**Q. 自動計算が失敗しました（INFEASIBLE）**
A. 全ての制約を満たすシフトが組めない状態です。以下を確認してください:
- グループの人数が足りているか
- 夜勤可能者（勤務配慮なし）が十分にいるか
- 休み希望が特定日に集中していないか
- 診断レポートに詳細な原因が記載されています

**Q. 一部のグループだけ失敗しました**
A. 部分出力モードにより、成功したグループのシフトは保存されます。失敗したグループは手動でシフトを作成してください。

**Q. シフト修正画面が重いです**
A. v3.0ではフィルター操作は即座に反映されます（サーバー通信なし）。初回の読み込みのみ時間がかかります。

**Q. 黄色の行は何ですか？**
A. 喀痰吸引資格者です。夜勤に資格者が配置されているか確認する目安です。

**Q. カレンダー登録せずに確定できますか？**
A. はい。「確定」ボタンを使えばカレンダー登録なしで確定できます。

**Q. フィルターで絞り込んだとき、他の職員の編集は消えますか？**
A. いいえ。フィルターは表示の切り替えだけです。全ての編集内容は保持されます。

---

## 困ったときは

1. まずアプリ内の **マニュアル** を確認してください
2. 診断レポートでエラー内容を確認してください
3. GAS実行ログ（Apps Script Editor → 実行数）を確認してください
4. Colab出力ログを確認してください
5. 解決しない場合はシステム管理者にご連絡ください
